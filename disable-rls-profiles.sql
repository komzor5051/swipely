-- ==========================================
-- –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–ª—è profiles
-- ==========================================
-- –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç Row Level Security –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã profiles
-- —á—Ç–æ–±—ã Telegram Bot (service_role) –º–æ–≥ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
--
-- ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –ù–ï –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è production!
-- –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –í–ö–õ–Æ–ß–ò–¢–¨ RLS –æ–±—Ä–∞—Ç–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏.
-- ==========================================

-- –û—Ç–∫–ª—é—á–∞–µ–º RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã profiles
ALTER TABLE profiles DISABLE ROW LEVEL SECURITY;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ RLS –æ—Ç–∫–ª—é—á–µ–Ω
SELECT tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public' AND tablename = 'profiles';

-- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è
DO $$
BEGIN
  RAISE NOTICE '‚ö†Ô∏è  RLS –¥–ª—è profiles –û–¢–ö–õ–Æ–ß–ï–ù (–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)';
  RAISE NOTICE '‚úÖ Telegram Bot —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –≤ profiles';
  RAISE NOTICE 'üîí –í–ê–ñ–ù–û: –í–∫–ª—é—á–∏—Ç—å RLS –æ–±—Ä–∞—Ç–Ω–æ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!';
END
$$;
