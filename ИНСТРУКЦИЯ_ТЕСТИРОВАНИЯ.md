# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Telegram –±–æ—Ç–µ

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –í–∫–ª—é—á–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
- **src/index.js:125-126** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É `user_messages`
- **src/index.js:255-262** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –≤ —Ç–∞–±–ª–∏—Ü—ã `usage_tracking` –∏ `projects`

### 2. –°–æ–∑–¥–∞–Ω—ã SQL —Å–∫—Ä–∏–ø—Ç—ã
- **fix-bot-rls-policies.sql** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –±–æ—Ç–∞

### 3. –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
```
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
ü§ñ Swipely Bot –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...
‚úÖ Swipely Bot –∑–∞–ø—É—â–µ–Ω!
```

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –®–ê–ì 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor:
   https://supabase.com/dashboard/project/ijmevkzcpsipyuufjemg/sql

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ **`fix-bot-rls-policies.sql`**

3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**

4. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```
   RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Telegram –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!
   ```

### –®–ê–ì 2: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞ (–Ω–∞–π–¥–∏—Ç–µ –ø–æ @username –∏–ª–∏ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤)

2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏)

3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   ```
   –°–æ–∑–¥–∞–π –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ —á–µ—Ä–µ–∑ Instagram
   ```

4. –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç:
   ```
   üìù –ü—Ä–∏–Ω—è–ª:
   "–°–æ–∑–¥–∞–π –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ —á–µ—Ä–µ–∑ Instagram"

   üìä –°–∫–æ–ª—å–∫–æ —Å–ª–∞–π–¥–æ–≤ —Å–æ–∑–¥–∞—Ç—å?
   ```

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª (–≥–¥–µ –∑–∞–ø—É—â–µ–Ω –±–æ—Ç) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥:

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω: [username] (profile_id: [uuid])
üíæ –°–æ—Ö—Ä–∞–Ω—è—é —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [user_id] –≤ Supabase...
üíæ –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [user_id]
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
```
‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è: { code: '42501', message: 'permission denied for table user_messages' }
```
‚Üí –ó–Ω–∞—á–∏—Ç SQL —Å–∫—Ä–∏–ø—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π

### –®–ê–ì 4: –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—É—Å–µ–ª—å (–ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç)

1. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–π–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5)

2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Minimal Pop)

3. –î–æ–∂–¥–∏—Ç–µ—Å—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (15-20 —Å–µ–∫—É–Ω–¥)

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
   ```
   üìä –°–æ—Ö—Ä–∞–Ω—è—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–∞—Ä—É—Å–µ–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [user_id]...
   üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [user_id]
   ```

### –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Supabase

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã user_messages

1. –û—Ç–∫—Ä–æ–π—Ç–µ Table Editor: https://supabase.com/dashboard/project/ijmevkzcpsipyuufjemg/editor

2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É **user_messages**

3. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ —Å –≤–∞—à–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏:
   ```
   profile_id: [uuid]
   telegram_id: [–≤–∞—à telegram id]
   message_text: "–°–æ–∑–¥–∞–π –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ —á–µ—Ä–µ–∑ Instagram"
   message_type: "text"
   created_at: [timestamp]
   ```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã usage_tracking

1. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É **usage_tracking**

2. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º–∏:
   ```
   user_id: [uuid]
   generation_type: "carousel"
   metadata: {
     "source": "telegram_bot",
     "telegram_id": [–≤–∞—à id],
     "style_preset": "minimal_pop",
     "slide_count": 5,
     "input_text": "–°–æ–∑–¥–∞–π –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ..."
   }
   ```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã projects

1. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É **projects**

2. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç—ã:
   ```
   user_id: [uuid]
   project_type: "carousel"
   title: "Telegram: –°–æ–∑–¥–∞–π –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ —á–µ—Ä–µ–∑..."
   data: { ... }
   ```

## üîç Troubleshooting

### –û—à–∏–±–∫–∞: permission denied for table user_messages

**–ü—Ä–∏—á–∏–Ω–∞:** RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏–ª–∏ service_role –∫–ª—é—á –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª –±–æ—Ç–∞ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **service_role** –∫–ª—é—á (–Ω–µ anon)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `fix-bot-rls-policies.sql` –≤ Supabase SQL Editor
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `pkill -f "node src/index.js" && npm start`

### –û—à–∏–±–∫–∞: relation "user_messages" does not exist

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
–í—ã–ø–æ–ª–Ω–∏—Ç–µ `fix-bot-rls-policies.sql` - –æ–Ω —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### –û—à–∏–±–∫–∞: function upsert_telegram_profile does not exist

**–ü—Ä–∏—á–∏–Ω–∞:** SQL —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
–í—ã–ø–æ–ª–Ω–∏—Ç–µ `fix-bot-rls-policies.sql` - –æ–Ω —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –Ω–æ –æ—à–∏–±–æ–∫ –Ω–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ catch –±–ª–æ–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±–æ—Ç–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤ `üíæ –°–æ—Ö—Ä–∞–Ω—è—é —Å–æ–æ–±—â–µ–Ω–∏–µ...`
2. –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç - –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥ —Å ‚ùå - —Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
SELECT
  um.message_text,
  um.message_type,
  um.created_at,
  p.telegram_username
FROM user_messages um
JOIN profiles p ON p.id = um.profile_id
WHERE p.telegram_id = [–≤–∞—à_telegram_id]
ORDER BY um.created_at DESC;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
```sql
SELECT
  p.telegram_username,
  COUNT(u.id) as total_generations,
  COUNT(CASE WHEN u.created_at >= DATE_TRUNC('month', NOW()) THEN 1 END) as this_month
FROM profiles p
LEFT JOIN usage_tracking u ON u.user_id = p.id
WHERE p.telegram_id IS NOT NULL
GROUP BY p.id, p.telegram_username
ORDER BY total_generations DESC;
```

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
```sql
SELECT
  p.telegram_username,
  u.generation_type,
  u.metadata->>'style_preset' as style,
  u.metadata->>'slide_count' as slides,
  u.metadata->>'input_text' as text,
  u.created_at
FROM usage_tracking u
JOIN profiles p ON p.id = u.user_id
WHERE u.metadata->>'source' = 'telegram_bot'
ORDER BY u.created_at DESC
LIMIT 20;
```

## üéØ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ /start
2. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è** - –≤ —Ç–∞–±–ª–∏—Ü—É user_messages
3. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π** - –≤ usage_tracking –∏ projects
4. ‚úÖ **–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞** - –±–æ—Ç —á–∏—Ç–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å—Ç–∏–ª—è
5. ‚úÖ **–£—á–µ—Ç –ª–∏–º–∏—Ç–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ usage_tracking (5 –¥–ª—è free, 50 –¥–ª—è pro)

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### user_messages
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è AI –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å—Ç–∏–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è).

### usage_tracking
–ü–æ–¥—Å—á–µ—Ç –ª–∏–º–∏—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π. Free tier: 5/–º–µ—Å—è—Ü, Pro: 50/–º–µ—Å—è—Ü.

### projects
–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ "–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã" –≤ –±—É–¥—É—â–µ–º.

## üîê Security Note

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **service_role** –∫–ª—é—á (–Ω–µ anon), –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ë–æ—Ç = backend —Å–µ—Ä–≤–∏—Å (–Ω–µ frontend)
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ service_role –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**–ù–ò–ö–û–ì–î–ê** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ service_role –∫–ª—é—á –≤–æ frontend (–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)!
